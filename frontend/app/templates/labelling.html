<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->  
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->  
<!--[if !IE]><!--> <html lang="en"> <!--<![endif]-->  
<head>
    <title>SEDMA labelling</title>
    <!-- Meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">    
    <link rel="shortcut icon" href="static/images/favicon.png"> 
    <link href='http://fonts.googleapis.com/css?family=Lato:300,400,300italic,400italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'> 
    <!-- Global CSS -->
    <link rel="stylesheet" href="/static/plugins/bootstrap/css/bootstrap.min.css">
    <!-- Plugins CSS -->    
    <link rel="stylesheet" href="/static/plugins/font-awesome/css/font-awesome.css">
    <link rel="stylesheet" href="/static/plugins/prism/prism.css">
    <!-- Theme CSS -->  
    <link id="theme-style" rel="stylesheet" href="/static/css/styles.css">
    <link href="/static/css/custom.css" rel="stylesheet">
    <link href="/static/css/sweetalert.css" rel="stylesheet">
</head> 

<body data-spy="scroll">
    
    <!-- ******HEADER****** --> 
    <header id="header" class="header">  
        <div class="container">            
            <h1 class="logo pull-left">
                <a class="ajax-link" id="to-index-page" href="index">
                    <span class="logo-title">SEDMA</span>
                </a>
            </h1><!--//logo-->              
            <nav id="main-nav" class="main-nav navbar-right" role="navigation">
                <div class="navbar-header">
                    <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button><!--//nav-toggle-->
                </div><!--//navbar-header-->            
                <div class="navbar-collapse collapse" id="navbar-collapse">
                    <ul class="nav navbar-nav">
                        <li class="active nav-item sr-only" id="to-index-page"><a class="ajax-link" href="index">Home</a></li>
                        <li class="nav-item" id="to-index-page"><a class="ajax-link" href="index">Home</a></li>
                        <!-- <li class="nav-item"><a class="scrollto" href="#features">Features</a></li>
                        <li class="nav-item"><a class="scrollto" href="#docs">Docs</a></li>
                        <li class="nav-item"><a class="scrollto" href="#license">License</a></li>                        
                        <li class="nav-item"><a class="scrollto" href="#contact">Contact</a></li> -->
                        <li class="nav-item" id="to-intro-page"><a class="ajax-link" href="introduction">Introduction</a></li>
                        <li class="nav-item" id="to-predict-page"><a class="ajax-link" href="predict">Predict</a></li>
                        <li class="nav-item" id="to-label-page"><a class="ajax-link" href="labelling">Label</a></li>
                        <li class="nav-item last" id="to-camera-page"><a class="ajax-link" href="camera">Camera</a></li>
                    </ul><!--//nav-->
                </div><!--//navabr-collapse-->
            </nav><!--//main-nav-->
        </div>
    </header><!--//header-->


    <section id="demo" class="license section">

        <div class="cta-container">
            <div class="speech-bubble-2">
                <h3 class="title text-center">Labelling image emotion</h3>                
                <!-- <p class="intro">Upload image and predict emotion</p> -->
            </div><!--//speech-bubble-->
        </div><!--//cta-container-->


        <div class="container">
            <!-- <div class="row"> -->
            <div class="col-md-12 text-center">

                <div class="btns">
                    <a class="btn btn-cta-primary" id="request-new-image">Request new image</a>
                    <br>
                    <p id="file-name"></p>
                </div>
            </div>
        

            <div class="col-md-12">
                <br><br>
                <div class="col-md-6 text-center">
                    <div class="license-inner">
                        <p><b><i class="fa fa-picture-o"></i>  Randomly queried image: </b></p>
                        <hr>
                        <img id="label-img" width = "100%"/>
                    </div>
                </div>


                <div class="col-md-3">
                    <!-- <div class="license-inner"> -->
                        <p><b><i class="fa fa-pencil-square-o"></i>  Please choose one category:</b></p>
                        <small><p>* Bold labels are recommended.</p></small>
                        <hr>
                        <form>
                            <input type="radio" name="emotion" id="amusement" value="amusement" disabled> <p style="display:inline;color:lightgrey;" id="amusement-p">amusement</p>
                            <br><br>
                            <input type="radio" name="emotion" id="awe" value="awe" disabled> <p style="display:inline; color:lightgrey;" id="awe-p">awe</p>
                            <br><br>
                            <input type="radio" name="emotion" id="contentment" value="contentment" disabled> <p style="display:inline;color:lightgrey;" id="contentment-p">contentment</p>
                            <br><br>
                            <input type="radio" name="emotion" id="excitement" value="excitement" disabled> <p style="display:inline;color:lightgrey;" id="excitement-p">excitement</p>
                            <br><br>
                            <input type="radio" name="emotion" id="anger" value="anger" disabled> <p style="display:inline;color:lightgrey;" id="anger-p">anger</p>
                            <br><br>
                            <input type="radio" name="emotion" id="disgust" value="disgust" disabled> <p style="display:inline;color:lightgrey;" id="disgust-p">disgust</p>
                            <br><br>
                            <input type="radio" name="emotion" id="fear" value="fear" disabled> <p style="display:inline;color:lightgrey;" id="fear-p">fear</p>
                            <br><br>
                            <input type="radio" name="emotion" id="sadness" value="sadness" disabled> <p style="display:inline;color:lightgrey;" id="sadness-p">sadness</p>
                        </form>
                    <!-- </div> -->
                </div>


                <div class="col-md-3">
                    <br><br><br><br><br><br><br><br>
                    <p><button type="button" id="submit-label" class="btn btn-danger">Submit label</button></p>
                </div>
            </div>
        </div>
          <!-- </div> -->
    </section><!--//promo-->



      
    <!-- ******FOOTER****** --> 
    <footer class="footer">
        <div class="container text-center">
            <i class="fa fa-copyright" aria-hidden="true"></i><small class="copyright">  All right reserved. 2017.</small>
        </div><!--//container-->
    </footer><!--//footer-->
     
    <!-- Javascript -->          
    <script type="text/javascript" src="/static/plugins/jquery-1.11.3.min.js"></script>   
    <script type="text/javascript" src="/static/plugins/jquery.easing.1.3.js"></script>   
    <script type="text/javascript" src="/static/plugins/bootstrap/js/bootstrap.min.js"></script>     
    <script type="text/javascript" src="/static/plugins/jquery-scrollTo/jquery.scrollTo.min.js"></script> 
    <script type="text/javascript" src="/static/plugins/prism/prism.js"></script>    
    <script type="text/javascript" src="/static/js/main.js"></script>
    <script src="/static/js/flot.js"></script>
    <script src="/static/js/sweetalert.min.js"></script>


    <script>
      var NEW_IMG_LABEL = "EMPTY";
      $(document).ready(function(){
        // Choose image button
        $("#upload-img").click(function(event){
          // console.log("Browse!");
        });


        $("#upload-img").change(function(event){
          if($("#upload-img")[0].files['length'] !== 0){
            $("#file-name").html($("#upload-img")[0].files[0]['name']);
          }
        });


        // Submit image button
        $("#submit-img").click(function(event){
          var file = $("#upload-img")[0];
          if(file.files['length'] == 0){
            sweetAlert("Error", "Please choose an image!", "error");
            return;
          }
          
          file = file.files[0];
          if(!/image\/\w+/.test(file.type)){
            sweetAlert("Error", "File is not image!", "error");
          }

          var reader = new FileReader();
          reader.readAsDataURL(file);

          reader.onload = function(evt){
            // console.log("image upload!")
            $("#predict-emotion").html("please wait...");
            document.getElementById('plot-img').src = evt.target.result;

            var imageData = evt.target.result;
            var fd = new FormData();
            fd.append("image-up", file)
            $.ajax({
              url: '/imgClassify',
              type: 'POST',
              cache: false,
              data: fd,
              processData: false,
              contentType: false,
              success: function(response){
                console.log("Submit!",response);
                if (response['message']=='success') {
                  // update prediction result
                  // console.log(response['predictResult'][0][0]);
                  var predictLable = response['predictResult'];

                  $("#predict-emotion").html(predictLable[1]);
                  swal("Success", "upload to database and get prediction!", "success"); 
                } else {
                  sweetAlert("Error", response['message'], "error");
                }
              },
            });
          }
        });


        $("#request-new-image").click(function(event){
          $.ajax({
            url: "{{ url_for('imageLable') }}", 
            type: 'GET',
            cache: false,
            data: {},
            success: function(response){
              $("#label-img").attr("src", response['img']);
              // console.log(response['img'])
              var weekLable = response['label'];
              NEW_IMG_LABEL = response['id'];
              // console.log("image id: ")
              // console.log(weekLable)

              // document.getElementById("amusement").disabled = true;
              // document.getElementById("awe").disabled = true;
              // document.getElementById("contentment").disabled = true;
              // document.getElementById("excitement").disabled = true;
              // document.getElementById("anger").disabled = true;
              // document.getElementById("disgust").disabled = true;
              // document.getElementById("fear").disabled = true;
              // document.getElementById("sadness").disabled = true;
              document.getElementById("amusement").disabled = false;
              document.getElementById("awe").disabled = false;
              document.getElementById("contentment").disabled = false;
              document.getElementById("excitement").disabled = false;
              document.getElementById("anger").disabled = false;
              document.getElementById("disgust").disabled = false;
              document.getElementById("fear").disabled = false;
              document.getElementById("sadness").disabled = false;
              document.getElementById("amusement-p").style.color="black";
              document.getElementById("amusement-p").style.font="17px arial,serif";
              document.getElementById("awe-p").style.color="black";
              document.getElementById("awe-p").style.font="17px arial,serif";
              document.getElementById("contentment-p").style.color="black";
              document.getElementById("contentment-p").style.font="17px arial,serif";
              document.getElementById("excitement-p").style.color="black";
              document.getElementById("excitement-p").style.font="17px arial,serif";
              document.getElementById("anger-p").style.color="black";
              document.getElementById("anger-p").style.font="17px arial,serif";
              document.getElementById("disgust-p").style.color="black";
              document.getElementById("disgust-p").style.font="17px arial,serif";
              document.getElementById("fear-p").style.color="black";
              document.getElementById("fear-p").style.font="17px arial,serif";
              document.getElementById("sadness-p").style.color="black";
              document.getElementById("sadness-p").style.font="17px arial,serif";




              for(var i = 0; i < weekLable.length; i++){
                // document.getElementById(weekLable[i]).disabled = false;
                document.getElementById(weekLable[i]+"-p").style.color="darkred";
                document.getElementById(weekLable[i]+"-p").style.font="italic bold 20px arial,serif";
              }

            },
            error: function(error){
              //console.log("Error GET!",error);
              sweetAlert("Error", "request new image error", "error");
            }
          });

        });


        $("#to-index-page").click(function(event){

          $.ajax({
            success: function(){
              window.location.href = '/index';
            },
            error: function(error){
              sweetAlert("Error", "page not exist!", "error");
            }
          });
        });


        $("#to-predict-page").click(function(event){

          $.ajax({
            success: function(){
              window.location.href = '/predict';
            },
            error: function(error){
              sweetAlert("Error", "page not exist!", "error");
            }
          });
        });

        $("#to-intro-page").click(function(event){

          $.ajax({
            success: function(){
              window.location.href = '/introduction';
            },
            error: function(error){
              sweetAlert("Error", "page not exist!", "error");
            }
          });
        });

        $("#to-label-page").click(function(event){

          $.ajax({
            // callback: $("#request-new-image").click(),
            success: function(){
              window.location.href = '/labelling';
            },
            error: function(error){
              //console.log("Error GET!",error);
              sweetAlert("Error", "page not exist!", "error");
            }
          });
        });


        $("#to-camera-page").click(function(event){

          $.ajax({
            success: function(){
              window.location.href = '/camera';
            },
            error: function(error){
              sweetAlert("Error", "page not exist!", "error");
            }
          });
        });


        $('#submit-label').click(function(event){
          var newLable = [];
          $("input[type=radio]:checked").each(function(){    
            newLable.push(this.value);
          });
          $.ajax({
            url: "/imageLable",
            type: 'POST',
            data: {
                    'label': newLable,
                    'imgId': NEW_IMG_LABEL,
                  },
            success: function(response){
              if (response['message']=='success') {
                swal("Success", "Submit new label!", "success");
                // automatically request another image
                console.log("in submit lable: ")
                console.log(NEW_IMG_LABEL);
                NEW_IMG_LABEL = "EMPTY";
                console.log(NEW_IMG_LABEL);
                $("#request-new-image").click();
              } else if(response['message']=='empty') {
                sweetAlert("Error", "Please choose at least one emotion!", "error");
              } else if(response['message']=='noImg') {
                sweetAlert("Error", "Please request a new image first!", "error");
              }
            },
            error: function(error){
              sweetAlert("Error", "Network Error. Send Label Error", "error");
            }
          });

        });


      });
    </script>


</body>
</html> 

